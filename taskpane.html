<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Add-in</title>
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
    <style>
        /* Styling for the floating suggestion */
        #floatingSuggestion {
            display: none;
            position: absolute;
            border: 1px solid #ccc;
            background-color: white;
            padding: 10px;
            z-index: 1000;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
        }

        /* Styling for the side panel */
        #sidePanel {
            position: fixed;
            right: 10px;
            top: 50px;
            width: 200px;
            border: 1px solid #ccc;
            background-color: white;
            padding: 10px;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>

<body>
    <div id="floatingSuggestion"></div>
    <div id="sidePanel">
        <p>Placeholder for content</p>
        <button id="button1">Button 1</button>
        <button id="button2">Button 2</button>
    </div>

    <script>
        Office.onReady((info) => {
            if (info.host === Office.HostType.Word) {
                document.addEventListener('mouseup', onTextSelect);
                document.getElementById('button1').addEventListener('click', () => performAction('Button 1'));
                document.getElementById('button2').addEventListener('click', () => performAction('Button 2'));
            }
        });

        async function onTextSelect(event) {
            await Word.run(async (context) => {
                const selection = context.document.getSelection();
                selection.load('text');
                await context.sync();

                if (selection.text) {
                    const suggestion = await fetchSuggestion(selection.text);
                    const { left, top } = await getSelectionPosition(selection);
                    showFloatingSuggestion(left, top, suggestion);
                } else {
                    hideFloatingSuggestion();
                }
            });
        }

        async function fetchSuggestion(selectedText) {
            const response = await fetch(`https://jsonplaceholder.typicode.com/posts/1`);
            const data = await response.json();
            return data.title; // Modify this to return relevant data based on selectedText
        }

        async function getSelectionPosition(selection) {
            // Use getRange to retrieve the bounding rectangle
            const range = selection.getRange();
            range.load('boundingRect');
            await Word.run(async (context) => {
                await context.sync();
            });

            // Calculate position above the selected text
            const left = range.boundingRect.left;
            const top = range.boundingRect.top - 50; // Adjust to position above
            return { left, top };
        }

        function showFloatingSuggestion(x, y, suggestion) {
            const suggestionBox = document.getElementById('floatingSuggestion');
            suggestionBox.innerText = suggestion;
            suggestionBox.style.left = `${x}px`;
            suggestionBox.style.top = `${y}px`;
            suggestionBox.style.display = 'block';
        }

        function hideFloatingSuggestion() {
            const suggestionBox = document.getElementById('floatingSuggestion');
            suggestionBox.style.display = 'none';
        }

        function performAction(action) {
            console.log(action);
            // Add additional functionality here
        }

        document.addEventListener('click', hideFloatingSuggestion);
    </script>
</body>

</html>
